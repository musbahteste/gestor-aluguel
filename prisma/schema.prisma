// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Locador {
  id        Int      @id @default(autoincrement())
  nome      String
  cpf       String?  @unique
  email     String?
  telefone  String?
  imoveis   Imovel[]
  contratos Contrato[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Locatario {
  id        Int      @id @default(autoincrement())
  nome      String
  cpf       String?  @unique
  email     String?
  telefone  String?
  contratos Contrato[]
  pagamentos Pagamento[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Imovel {
  id          Int       @id @default(autoincrement())
  titulo      String
  descricao   String?
  endereco    String
  cidade      String?
  bairro      String?
  cep         String?
  valorAluguel Float
  area        Float?
  quartos     Int?
  banheiros   Int?
  garagem     Boolean  @default(false)
  locadorId   Int?
  locador     Locador?  @relation(fields: [locadorId], references: [id])
  contratos   Contrato[]
  pagamentos  Pagamento[]
  gastos      Gasto[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ContratoTemplate {
  id        Int      @id @default(autoincrement())
  nome      String
  conteudo  String   // armazena o template com placeholders (ex: {{locador.nome}})
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  contratos Contrato[]
}

model Contrato {
  id             Int               @id @default(autoincrement())
  templateId     Int
  template       ContratoTemplate  @relation(fields: [templateId], references: [id])
  imovelId       Int
  imovel         Imovel            @relation(fields: [imovelId], references: [id])
  locadorId      Int
  locador        Locador           @relation(fields: [locadorId], references: [id])
  locatarioId    Int
  locatario      Locatario         @relation(fields: [locatarioId], references: [id])
  conteudoGerado String
  dataGeracao    DateTime          @default(now())

  // Novos campos
  dataVencimento DateTime          // Data de vencimento do contrato
  valorReceber   Float             // Valor a ser recebido mensalmente
  tempoContrato  Int               // Tempo de contrato em meses

  contasReceber  ContaReceber[]    // Relacionamento com contas a receber
}

model ContaReceber {
  id             Int      @id @default(autoincrement())
  contratoId     Int
  contrato       Contrato @relation(fields: [contratoId], references: [id])
  dataVencimento DateTime // Data de vencimento da conta
  valor          Float    // Valor da conta
  status         String   @default("pendente") // "pendente", "atrasado", "recebido"
  dataRecebimento DateTime? // Data em que foi recebido (se aplic√°vel)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Pagamento {
  id           Int      @id @default(autoincrement())
  imovelId     Int
  imovel       Imovel   @relation(fields: [imovelId], references: [id])
  valor        Float
  dataPagamento DateTime
  dataVencimento DateTime?
  descricao    String?
  metodo       String   // "dinheiro", "cheque", "transferencia", "pix"
  status       String   @default("recebido") // "recebido", "pendente", "atrasado"
  comprovante  String?  // Armazena o comprovante em base64
  locatarioId  Int?
  locatario    Locatario? @relation(fields: [locatarioId], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Gasto {
  id        Int      @id @default(autoincrement())
  imovelId  Int
  imovel    Imovel   @relation(fields: [imovelId], references: [id], onDelete: Cascade)
  tipo      String   // "pintura", "iptu", "manutencao", "limpeza", "reparos", "outro"
  descricao String?
  valor     Float
  dataGasto DateTime
  arquivo   String?  // URL ou caminho do arquivo/comprovante
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Boleto {
  id            Int      @id @default(autoincrement())
  mpPaymentId   String   @unique
  vencimento    DateTime?
  url           String
  valor         Float
  payerFirstName String
  payerLastName  String
  barcode       String?
  raw           Json?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Pix {
  id            Int      @id @default(autoincrement())
  mpPaymentId   String   @unique
  qrCodeBase64  String?
  qrCodeText    String?
  valor         Float
  payerFirstName String
  payerLastName  String
  raw           Json?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model LinkPagamento {
  id           Int      @id @default(autoincrement())
  preferenceId String   @unique
  firstName    String
  lastName     String
  valor        Float
  link         String
  raw          Json?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model User {
  id         Int      @id @default(autoincrement())
  username   String   @unique
  email      String?  @unique
  password   String
  role       String   @default("user")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}